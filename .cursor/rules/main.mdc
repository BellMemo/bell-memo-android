# Cursor AI 规则 - 通用开发指南

## 代码风格与最佳实践

### 通用原则
- 编写清晰、可读、可维护的代码
- 遵循项目现有的代码风格和约定
- 优先使用显式而非隐式代码
- 使用有意义的变量和函数名
- 保持函数小而专注，单一职责原则
- 避免深层嵌套（最多 3-4 层）
- 注释复杂逻辑，但优先编写自文档化代码

### 代码组织
- 将相关代码组织在一起
- 分离关注点（UI、业务逻辑、数据层）
- 使用一致的文件和文件夹命名约定
- 保持文件专注，避免上帝类/文件
- 组织导入：标准库优先，然后是第三方库，最后是本地文件

### 错误处理
- 始终显式处理错误
- 提供有意义的错误消息
- 使用适当的错误处理机制（try-catch、Result 类型等）
- 永远不要静默吞掉错误
- 适当记录错误以便调试

### 性能
- 避免过早优化
- 优化前先进行性能分析
- 注意内存使用
- 只优化关键路径
- 在适当的时候使用懒加载
- 缓存昂贵的计算（当有益时）

### 安全性
- 永远不要提交密钥、API 密钥或凭证
- 验证和清理用户输入
- 对数据库操作使用参数化查询
- 遵循最小权限原则
- 保持依赖项更新
- 审查第三方包的安全影响

## Flutter/Dart 特定规则

### Dart 风格指南
- 遵循官方 Dart 风格指南：https://dart.dev/guides/language/effective-dart/style
- 尽可能使用 `const` 构造函数
- 当变量不会被重新赋值时，优先使用 `final` 而非 `var`
- 适当使用空安全特性
- 仅在必要时且安全时使用 `late` 关键字

### Flutter 最佳实践
- 尽可能使用 `const` widget 以提高性能
- 当不需要状态时，优先使用 `StatelessWidget` 而非 `StatefulWidget`
- 当 widget 变得复杂时，将其提取到单独的文件中
- 对依赖于 context 的 widget 使用 `Builder` 模式
- 避免在 build 方法中使用 `setState`
- 适当使用 `Key` 来标识 widget

### 状态管理
- 根据复杂度选择适当的状态管理解决方案
- 尽可能保持状态局部化
- 当多个 widget 需要时，将状态提升
- 使用 providers、bloc 或 riverpod 管理全局状态
- 避免属性传递 - 使用状态管理解决方案代替

### Widget 组织
- 一个 widget 一个文件（除了小的、相关的 widget）
- 使用描述性的 widget 类名
- 将可复用的 widget 提取到单独的文件中
- 保持 build 方法清洁和可读
- 优先使用组合而非继承

### 资源与资源文件
- 将资源放在适当的目录中（`assets/`、`lib/assets/`）
- 使用从项目根目录的相对路径引用资源
- 使用适当的图片格式（尽可能使用 WebP）
- 添加到项目前优化图片

### 测试
- 为业务逻辑编写单元测试
- 为 UI 组件编写 widget 测试
- 为关键用户流程编写集成测试
- 在重要代码路径上追求良好的测试覆盖率
- 保持测试简单和专注

## 文件与项目结构

### 命名约定
- 文件名使用 snake_case（例如：`user_profile.dart`）
- 类名使用 PascalCase（例如：`UserProfile`）
- 变量和函数名使用 camelCase（例如：`userName`、`getUserData()`）
- 常量使用 UPPER_SNAKE_CASE（例如：`MAX_RETRY_COUNT`）

### 目录结构
- 将相关文件放在一起
- 在适当时使用基于功能的组织方式
- 分离 UI、模型、服务和工具类
- 保持根目录整洁

### 文档
- 为公共 API 编写清晰的文档注释
- 使用 `///` 进行文档注释
- 记录复杂的算法和业务逻辑
- 保持 README.md 更新
- 在 CHANGELOG.md 中记录破坏性更改

## Git 与版本控制

### 提交信息规范

#### 提交信息格式
提交信息应遵循以下格式：
```
<类型>(<范围>): <主题>

<正文>

<脚注>
```

#### 提交类型（Type）
使用以下类型标识提交的性质：
- `feat`: 新功能
- `fix`: 修复 bug
- `docs`: 文档变更
- `style`: 代码格式调整（不影响代码运行）
- `refactor`: 代码重构（既不是新功能也不是 bug 修复）
- `perf`: 性能优化
- `test`: 添加或修改测试
- `chore`: 构建过程或辅助工具的变动
- `ci`: CI 配置文件和脚本的变更
- `build`: 构建系统或外部依赖的变更
- `revert`: 回滚之前的提交

#### 范围（Scope）
可选，表示影响的范围，例如：
- `ui`: 用户界面
- `api`: API 相关
- `db`: 数据库
- `auth`: 认证相关
- `config`: 配置相关
- `deps`: 依赖项

#### 主题（Subject）
- 使用祈使句，现在时态（"添加功能" 而非 "已添加功能"）
- 首字母小写
- 结尾不加句号
- 不超过 50 个字符
- 简洁明了地描述本次提交

#### 正文（Body）
- 可选，用于详细说明提交的原因和变更内容
- 每行不超过 72 个字符
- 说明"为什么"而不是"做了什么"（主题已经说明了做了什么）
- 可以包含与之前版本的对比

#### 脚注（Footer）
- 可选，用于关闭 Issue 或引用相关资源
- 格式：`Closes #123` 或 `Refs #456`

#### 提交信息示例
```
feat(ui): 添加用户登录页面

实现了用户登录界面，包括用户名和密码输入框，
以及登录按钮。集成了表单验证功能。

Closes #123
```

```
fix(api): 修复用户数据获取接口的 500 错误

修复了当用户不存在时返回 500 错误的问题，
现在会正确返回 404 状态码。

Fixes #456
```

```
docs: 更新 README 中的安装说明

添加了 Flutter 环境配置的详细步骤。
```

```
refactor(db): 重构用户数据访问层

将用户数据访问逻辑从 Controller 中分离出来，
创建独立的 Repository 类以提高代码可维护性。
```

#### 提交信息最佳实践
- 编写清晰、描述性的提交信息
- 使用现在时态（"添加功能" 而非 "已添加功能"）
- 在适用时引用问题编号（使用 `Closes #123` 或 `Fixes #456`）
- 保持提交专注和原子性（一次提交只做一件事）
- 不要提交注释掉的代码
- 主题行要简洁明了，详细说明放在正文中
- 如果提交修复了 bug，在主题行中包含 bug 编号
- 如果提交包含破坏性变更，在脚注中使用 `BREAKING CHANGE:` 说明

#### 提交前检查
- 确保代码可以编译通过
- 运行 linter 并修复所有警告
- 运行测试并确保全部通过
- 检查是否有未提交的文件
- 确认提交信息符合规范

### 分支管理

#### 分支命名规范
- `main` 或 `master`: 主分支，用于生产环境
- `develop`: 开发分支，用于集成开发
- `feature/<功能名>`: 功能分支，例如 `feature/user-login`
- `fix/<bug描述>`: Bug 修复分支，例如 `fix/login-error`
- `hotfix/<问题描述>`: 紧急修复分支，例如 `hotfix/security-patch`
- `release/<版本号>`: 发布分支，例如 `release/v1.0.0`
- `docs/<文档描述>`: 文档分支，例如 `docs/api-docs`

#### 分支管理最佳实践
- 使用有意义的分支名，清晰描述分支用途
- 保持分支与主分支同步，定期合并主分支的更新
- 功能完成后及时合并并删除功能分支
- 为新工作使用功能分支，不要直接在主分支上开发
- 一个功能一个分支，避免在一个分支上做多个不相关的修改
- 定期清理已合并的分支，保持仓库整洁
- 使用 Pull Request 或 Merge Request 进行代码审查

#### 分支工作流
1. 从 `main` 或 `develop` 创建功能分支
2. 在功能分支上开发和提交
3. 完成功能后，创建 Pull Request
4. 代码审查通过后，合并到主分支
5. 删除已合并的功能分支

## 代码审查指南

### 提交前
- 自我审查代码
- 运行 linter 并修复警告
- 确保测试通过
- 如需要，更新文档
- 检查安全问题

### 审查清单
- 代码遵循风格指南
- 没有明显的错误或 bug
- 包含测试且测试通过
- 文档已更新
- 没有添加不必要的依赖
- 已考虑性能问题

## 应避免的常见模式

- 不要使用魔法数字 - 使用命名常量
- 不要重复代码 - 提取到函数/widget
- 不要在没有充分理由的情况下忽略 linter 警告
- 不要创建不必要的抽象
- 不要过早优化
- 不要编写过于聪明的代码
- 不要混合关注点（UI 逻辑与业务逻辑）
- 不要创建上帝对象/类

## 请求帮助时

- 提供关于你试图实现的目标的上下文
- 包含相关的代码片段
- 提及你已经尝试过的方法
- 如果适用，分享错误消息
- 指定预期与实际行为

## AI 助手指南

- 建议改进，而不仅仅是实现
- 解释建议背后的推理
- 在适当时提供替代方案
- 考虑边缘情况和错误场景
- 考虑可维护性和可扩展性
- 尊重项目中现有的代码模式
- 当需求不清楚时，询问澄清问题

## 代码生成规范

### 生成代码时
- 优先使用项目现有的代码模式和架构
- 遵循项目的命名约定和文件结构
- 包含必要的导入语句
- 添加适当的错误处理
- 考虑边界情况和异常情况
- 生成可测试的代码

### 代码修改时
- 保持现有代码风格一致
- 不要破坏现有功能
- 进行最小化更改
- 更新相关测试
- 更新相关文档

### 代码重构时
- 保持功能不变
- 逐步重构，不要一次性大改
- 确保测试覆盖
- 保持向后兼容性（如可能）

## 项目特定规则

### Flutter 项目
- 使用 Material Design 3（如果适用）
- 遵循响应式设计原则
- 考虑不同屏幕尺寸
- 优化启动时间和性能
- 使用适当的包管理（pub.dev）

### 多平台支持
- 考虑 Android、iOS、Web、桌面平台的差异
- 使用平台特定的代码时添加注释
- 测试所有目标平台
- 处理平台特定的限制和特性
